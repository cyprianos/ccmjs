#! /usr/bin/env node

var ccm = require('../ccm.js');
var fs = require('fs');
var util = require('util');
var glob = require('glob');
var argv = require('optimist')
            .default('files', './**/*.js')
            .default('encoding', 'utf8')
            .default('results', '25')
            .argv;

            
var topResult = ccm.createResult(parseInt(argv.topResultCount));
glob(argv.files, function(err, files) {

  files.forEach(function(file) {
    try {
      var fileContent = fs.readFileSync(file, { encoding: argv.encoding });
      var res = ccm.calculate( fileContent );
      res.file = file;
      topResult.addResult(res);
    } catch(err) {
      console.log(util.inspect(err));
    }

    console.log(ccm.formatResult(topResult));
  });
});


